<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³ÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ===== âš ï¸ Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ù‡Ù†Ø§ Ø¨Ø¯Ù‚Ø© Ø´Ø¯ÙŠØ¯Ø© =====
        const firebaseConfig = {
  apiKey: "AIzaSyC14Dt5V0Q1q7RYDre_TuYcuejoahhd478",
  authDomain: "syriaapp-cf66d.firebaseapp.com",
  projectId: "syriaapp-cf66d",
  storageBucket: "syriaapp-cf66d.firebasestorage.app",
  messagingSenderId: "436974106636",
  appId: "1:436974106636:web:a4b27a28fa51f3e80b9629",
  measurementId: "G-4T7GXLG5BH"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;
        window.fbUtils = { collection, addDoc, onSnapshot, query, orderBy, limit, serverTimestamp };
    </script>

    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; }
        .page { display: none; transition: all 0.3s ease; }
        .page.active { display: block; }
        .ad-card { animation: slideIn 0.4s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #toast {
            visibility: hidden; min-width: 250px; background-color: #064e3b; color: #fff;
            text-align: center; border-radius: 50px; padding: 12px; position: fixed;
            z-index: 1000; left: 50%; bottom: 100px; transform: translateX(-50%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        #toast.show { visibility: visible; }
    </style>
</head>
<body class="text-slate-900">

    <div id="toast">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­</div>

    <div class="max-w-md mx-auto bg-white min-h-screen flex flex-col shadow-xl border-x">
        
        <!-- Header -->
        <header class="bg-[#10b981] text-white p-4 sticky top-0 z-50 shadow-md">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold flex items-center gap-2">
                        <span>Ø³ÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</span>
                        <span class="text-[10px] bg-red-600 px-1.5 py-0.5 rounded animate-pulse">LIVE</span>
                    </h1>
                    <p class="text-[10px] text-green-100 italic">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­</p>
                </div>
                <div id="conn-indicator" class="flex flex-col items-end">
                    <span class="flex items-center gap-1 text-[9px]">
                        <span id="dot" class="w-2 h-2 bg-red-500 rounded-full"></span>
                        <span id="status-text">Ø£ÙˆÙÙ„Ø§ÙŠÙ†</span>
                    </span>
                    <button onclick="askAdminCode()" class="mt-1 text-xs underline">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-4 space-y-4 pb-24">
            
            <!-- Home Page -->
            <section id="home" class="page active">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="font-bold text-slate-700">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h2>
                    <button onclick="refreshData()" class="text-xs text-green-600 font-bold">ØªØ­Ø¯ÙŠØ« ğŸ”„</button>
                </div>
                
                <div id="live-ads-container" class="space-y-3">
                    <!-- Loading State -->
                    <div class="text-center py-20 opacity-50">
                        <div class="animate-spin text-3xl mb-2">â³</div>
                        <p class="text-sm">Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...</p>
                    </div>
                </div>
            </section>

            <!-- Admin Page -->
            <section id="admin" class="page">
                <div class="bg-slate-100 p-4 rounded-2xl mb-4 border-2 border-dashed border-slate-300">
                    <h2 class="font-bold text-red-600 mb-4">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯ (Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„)</h2>
                    <div class="space-y-3">
                        <input id="new-title" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" class="w-full p-3 rounded-xl border-none shadow-inner bg-white text-sm outline-none focus:ring-2 focus:ring-green-500">
                        <textarea id="new-desc" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†..." class="w-full p-3 rounded-xl border-none shadow-inner bg-white text-sm h-32 outline-none focus:ring-2 focus:ring-green-500"></textarea>
                        <button id="submit-ad" onclick="sendToCloud()" class="w-full bg-[#10b981] text-white py-4 rounded-xl font-bold shadow-lg active:scale-95 transition-all">
                            Ù†Ø´Ø± Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ ÙƒØ§ÙØ© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
                        </button>
                    </div>
                </div>
                <button onclick="showPage('home')" class="w-full text-slate-400 text-xs">Ø¥Ù„ØºØ§Ø¡ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            </section>

        </main>

        <!-- Navigation -->
        <nav class="fixed bottom-0 w-full max-w-md bg-white border-t flex justify-around p-3 shadow-2xl z-50">
            <button onclick="showPage('home')" class="flex flex-col items-center gap-1 text-green-600">
                <span class="text-2xl">ğŸ›ï¸</span>
                <span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            <button onclick="askAdminCode()" class="flex flex-col items-center gap-1 text-slate-400">
                <span class="text-2xl">âš™ï¸</span>
                <span class="text-[10px] font-bold">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
            </button>
        </nav>

        <!-- Password Modal -->
        <div id="pwd-modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-6 z-[1000]">
            <div class="bg-white rounded-3xl p-6 w-full max-w-xs text-center shadow-2xl scale-in">
                <div class="text-4xl mb-4">ğŸ”</div>
                <h3 class="font-bold text-lg mb-2">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
                <input id="pwd-input" type="password" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„" class="w-full p-3 border-2 border-slate-100 rounded-xl text-center text-xl font-bold tracking-widest outline-none focus:border-green-500">
                <button onclick="verifyAndEnter()" class="w-full bg-[#10b981] text-white mt-4 py-3 rounded-xl font-bold shadow-md">Ø¯Ø®ÙˆÙ„</button>
                <button onclick="closeModal()" class="w-full text-slate-400 mt-3 text-xs">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>

    </div>

    <script>
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ±Ø­ÙŠØ¨
        window.onload = function() {
            const t = document.getElementById("toast");
            t.className = "show";
            setTimeout(() => { t.className = ""; }, 3000);
            
            // Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            initApp();
        };

        function initApp() {
            let retry = setInterval(() => {
                if(window.db) {
                    clearInterval(retry);
                    document.getElementById('dot').classList.replace('bg-red-500', 'bg-green-500');
                    document.getElementById('status-text').innerText = "Ù…ØªØµÙ„ Ù…Ø¨Ø§Ø´Ø±";
                    startLiveStreaming();
                }
            }, 500);
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        function askAdminCode() { document.getElementById('pwd-modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('pwd-modal').classList.add('hidden'); }

        function verifyAndEnter() {
            if(document.getElementById('pwd-input').value === "09962") {
                closeModal();
                showPage('admin');
                document.getElementById('pwd-input').value = "";
            } else { alert("Ø§Ù„ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦!"); }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø®ØªÙ… Ø²Ù…Ù†ÙŠ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± (Server Timestamp)
        async function sendToCloud() {
            const title = document.getElementById('new-title').value;
            const desc = document.getElementById('new-desc').value;
            if(!title) return alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†");

            const btn = document.getElementById('submit-ad');
            btn.disabled = true;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø« Ù„Ù„Ø³Ø­Ø§Ø¨Ø©...";

            try {
                await window.fbUtils.addDoc(window.fbUtils.collection(window.db, "syria_ads"), {
                    title: title,
                    description: desc,
                    createdAt: window.fbUtils.serverTimestamp(), // Ø®ØªÙ… ÙˆÙ‚Øª Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Ø¬ÙˆØ¬Ù„
                    author: "Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­"
                });
                document.getElementById('new-title').value = "";
                document.getElementById('new-desc').value = "";
                showPage('home');
            } catch (e) {
                alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + e.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ ÙƒØ§ÙØ© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©";
            }
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¸Ø§Ù… Live Snapshot (Ø£Ù‡Ù… Ø¬Ø²Ø¡)
        function startLiveStreaming() {
            const q = window.fbUtils.query(
                window.fbUtils.collection(window.db, "syria_ads"), 
                window.fbUtils.orderBy("createdAt", "desc"),
                window.fbUtils.limit(50)
            );

            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ø­ÙŠ (onSnapshot) ÙŠØ¶Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙÙˆØ±Ø§Ù‹
            window.fbUtils.onSnapshot(q, (snapshot) => {
                const container = document.getElementById('live-ads-container');
                container.innerHTML = "";
                
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-center text-slate-400 py-10 text-xs">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ©</p>';
                    return;
                }

                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const card = `
                        <div class="ad-card bg-white p-4 rounded-2xl shadow-sm border border-slate-100 border-r-4 border-green-500">
                            <h4 class="font-bold text-slate-800">${data.title}</h4>
                            <p class="text-[11px] text-slate-500 mt-2 leading-relaxed">${data.description || ''}</p>
                            <div class="mt-3 flex justify-between items-center text-[8px] text-slate-300 font-bold uppercase tracking-widest">
                                <span>Ø¨ÙˆØ§Ø³Ø·Ø©: ${data.author || 'Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­'}</span>
                                <span>Ù…ÙØ­Ø¯Ù‘Ø« Ø§Ù„Ø¢Ù†</span>
                            </div>
                        </div>`;
                    container.innerHTML += card;
                });
            }, (error) => {
                console.error("Snapshot Error:", error);
                document.getElementById('live-ads-container').innerHTML = '<p class="text-red-500 text-center text-xs">ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ (Rules) ÙÙŠ Firebase Console</p>';
            });
        }

        function refreshData() {
            location.reload();
        }
    </script>
</body>
</html>


